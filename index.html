<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Web ƒê·ªçc Truy·ªán ‚Äì T·ª± ƒë·ªông nh·∫≠n truy·ªán</title>
<style>
:root { --primary:#2d89ef; --bg:#f7f7f7; --text:#222; }
*{box-sizing:border-box} body{margin:0;font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);color:var(--text)}
header{position:sticky;top:0;z-index:10;background:var(--primary);color:#fff;padding:12px 56px;text-align:center}
.home-btn{position:absolute;left:12px;top:12px;border:none;border-radius:6px;padding:6px 10px;background:#fff;color:var(--primary);cursor:pointer}
main{padding:14px;display:flex;flex-wrap:wrap;gap:16px;justify-content:center;min-height:60vh}
.truyen-card{width:200px;background:#fff;border-radius:10px;box-shadow:0 2px 6px rgba(0,0,0,.2);overflow:hidden;cursor:pointer;transition:.2s}
.truyen-card:hover{transform:translateY(-3px);box-shadow:0 6px 14px rgba(0,0,0,.25)}
.truyen-card img{width:100%;height:260px;object-fit:cover;display:block}
.truyen-card h3{margin:0;padding:10px;font-size:16px}

.reading-container{max-width:1000px;margin:0 auto;width:100%}
.chapter-controls{position:sticky;top:56px;z-index:9;background:#fff;border-radius:8px;box-shadow:0 2px 4px rgba(0,0,0,.08);padding:8px 10px;margin-bottom:10px;display:flex;gap:8px;align-items:center;justify-content:space-between}
.chapter-controls select,.chapter-controls button{padding:8px 12px;border:1px solid #ddd;border-radius:6px;background:#fff;cursor:pointer}
.chapter-title{text-align:center;margin:8px 0 12px;font-size:20px}
#manga-pages{display:flex;flex-direction:column;gap:8px}
.page{width:100%;text-align:center}
.page img{max-width:100%;height:auto;border-radius:6px;box-shadow:0 2px 6px rgba(0,0,0,.18);background:#eee;content-visibility:auto}
.skel{width:100%;height:320px;border-radius:6px;background:#eee}
.badge{font-size:12px;padding:4px 8px;border-radius:999px;background:#eef;color:#234}
.tip{font-size:13px;color:#666;text-align:center;margin:8px 0 16px}
.floater{position:fixed;right:14px;bottom:14px;display:flex;flex-direction:column;gap:10px;z-index:20}
.float-btn{border:none;border-radius:999px;padding:10px 14px;background:#fff;color:var(--primary);box-shadow:0 4px 12px rgba(0,0,0,.2);cursor:pointer;font-weight:600}
.hidden{display:none}
</style>
</head>
<body>
<header>
  <h1>üìñ Web ƒê·ªçc Truy·ªán</h1>
  <button class="home-btn" onclick="goHome()">Trang ch·ªß</button>
</header>

<main>
  <div id="truyen-list"></div>
  <div id="reading-page" class="hidden">
    <div class="reading-container">
      <div class="chapter-controls" id="chapter-top">
        <div style="display:flex;gap:8px;align-items:center">
          <button id="prev-chap">Chap tr∆∞·ªõc</button>
          <select id="chap-select"></select>
          <button id="next-chap">Chap sau</button>
        </div>
        <div><span id="page-indicator" class="badge">Trang 0</span></div>
      </div>
      <h2 class="chapter-title" id="chapter-title"></h2>
      <div id="manga-pages"></div>
      <p class="tip">Cu·ªôn d·ªçc, ·∫£nh t·∫£i l∆∞·ªùi (lazy load), t·ªëi ∆∞u m·∫°ng y·∫øu.</p>
    </div>
  </div>
</main>

<div id="floater" class="floater hidden">
  <button class="float-btn" id="to-top">‚§¥ L√™n ƒë·∫ßu chap</button>
  <button class="float-btn" id="to-bottom">‚§µ Xu·ªëng cu·ªëi chap</button>
</div>

<script>
const BASE = (() => {
  const p = location.pathname;
  return p.endsWith('/') ? p : p.replace(/[^/]+$/, '');
})();

let truyenList = []; // s·∫Ω d√≤ t·ª± ƒë·ªông
let currentTruyen=null,currentChap=1;

/* ===== Helpers ===== */
const $ = id => document.getElementById(id);
const pageUrl = (folder, chap, page, pat) =>
  pat==='backslash'
   ? `${BASE}${folder}/Chap${chap}/Chap${chap}%5C${page}.jpg`
   : `${BASE}${folder}/Chap${chap}/${page}.jpg`;

async function probe(url){
  return new Promise(res=>{
    const img=new Image();
    img.onload=()=>res(true);
    img.onerror=()=>res(false);
    img.src=url;
  });
}

/* ===== T·ª± ƒë·ªông d√≤ danh s√°ch truy·ªán ===== */
async function discoverTruyen(){
  // T·∫°m: v√¨ kh√¥ng list ƒë∆∞·ª£c folder GitHub, n√™n ta s·∫Ω th·ª≠ t·ª´ Manhwa1‚ÜíManhwa20
  // N·∫øu c√≥ bg.jpg th√¨ coi nh∆∞ t·ªìn t·∫°i
  const maxGuess=20;
  for(let i=1;i<=maxGuess;i++){
    const folder=`Manhwa${i}`;
    const cover=`${BASE}${folder}/bg.jpg`;
    if(await probe(cover)){
      // ƒê·∫øm chap
      let c=1;
      while(await probe(`${BASE}${folder}/Chap${c}/1.jpg`)) c++;
      truyenList.push({ten:folder,folder,cover:`${folder}/bg.jpg`,soChap:c-1});
    }
  }
}

/* ===== Trang ch·ªß ===== */
async function renderList(){
  await discoverTruyen();
  const list=$('truyen-list');
  list.innerHTML='';
  truyenList.forEach(t=>{
    const card=document.createElement('div');
    card.className='truyen-card';
    card.innerHTML=`<img src="${BASE}${t.cover}" onerror="this.src='https://via.placeholder.com/200x260?text=·∫¢nh+b√¨a'"><h3>${t.ten}</h3><p>${t.soChap} ch∆∞∆°ng</p>`;
    card.onclick=()=>openTruyen(t);
    list.appendChild(card);
  });
}

/* ===== ƒê·ªçc truy·ªán ===== */
function openTruyen(t){
  currentTruyen=t; currentChap=1;
  $('truyen-list').classList.add('hidden');
  $('reading-page').classList.remove('hidden');
  document.querySelector('header h1').textContent=`üìñ ${t.ten}`;
  const sel=$('chap-select'); sel.innerHTML='';
  for(let i=1;i<=t.soChap;i++){
    const o=document.createElement('option');
    o.value=i; o.textContent=`Ch∆∞∆°ng ${i}`;
    if(i===1)o.selected=true;
    sel.appendChild(o);
  }
  loadChap(1);
}

function goHome(){
  $('reading-page').classList.add('hidden');
  $('truyen-list').classList.remove('hidden');
  document.querySelector('header h1').textContent='üìñ Web ƒê·ªçc Truy·ªán';
  currentTruyen=null;
}

async function loadChap(ch){
  currentChap=ch;
  $('chap-select').value=ch;
  $('chapter-title').textContent=`${currentTruyen.ten} - Ch∆∞∆°ng ${ch}`;
  const wrap=$('manga-pages'); wrap.innerHTML='';
  let p=1;
  while(await probe(`${BASE}${currentTruyen.folder}/Chap${ch}/${p}.jpg`)){
    const img=document.createElement('img');
    img.loading='lazy'; img.src=`${BASE}${currentTruyen.folder}/Chap${ch}/${p}.jpg`;
    img.alt=`Trang ${p}`;
    const d=document.createElement('div'); d.className='page'; d.appendChild(img);
    wrap.appendChild(d);
    $('page-indicator').textContent=`Trang ${p}`;
    p++;
    if(p>2000) break; // ch·∫∑n v√≤ng l·∫∑p v√¥ t·∫≠n
  }
}

/* ===== S·ª± ki·ªán ===== */
document.addEventListener('DOMContentLoaded',()=>{
  renderList();
  $('prev-chap').onclick=()=>{if(currentChap>1)loadChap(currentChap-1)};
  $('next-chap').onclick=()=>{if(currentTruyen&&currentChap<currentTruyen.soChap)loadChap(currentChap+1)};
  $('chap-select').onchange=e=>loadChap(parseInt(e.target.value));
  $('to-top').onclick=()=>$('chapter-top').scrollIntoView({behavior:'smooth'});
  $('to-bottom').onclick=()=>window.scrollTo({top:document.body.scrollHeight,behavior:'smooth'});
  window.addEventListener('scroll',()=>{
    $('floater').classList.toggle('hidden',window.scrollY<400||$('reading-page').classList.contains('hidden'));
  });
});
</script>
</body>
</html>